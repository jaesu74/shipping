<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>해운 데이터 센터</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f5f7fa;
        }
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .card-header {
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            font-weight: 600;
        }
        .stats-card {
            text-align: center;
            padding: 15px;
        }
        .stat-value {
            font-size: 24px;
            font-weight: 700;
        }
        .stat-label {
            font-size: 14px;
            color: #6c757d;
        }
        .positive {
            color: #28a745;
        }
        .negative {
            color: #dc3545;
        }
        .navbar-brand {
            font-weight: 700;
        }
        .footer {
            margin-top: 50px;
            padding: 20px 0;
            background-color: #343a40;
            color: white;
        }
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255,255,255,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .category-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div id="loading">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/"><i class="bi bi-ship"></i> 해운 데이터 센터</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="/">홈</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/indices">해운 지수</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/ports">항만 혼잡도</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/freight">운임 정보</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/market">시장 동향</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/api/status" target="_blank">API 상태</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h1 class="text-center mb-4">실시간 해운 데이터 센터</h1>
                        <p class="text-center">전 세계 해운 지수, 항만 현황, 운임 정보를 실시간으로 제공합니다.</p>
                        <p class="text-center text-secondary" id="lastUpdate">최종 업데이트: 로딩 중...</p>
                    </div>
                </div>
            </div>
        </div>

        <h2 class="mt-4 mb-3">주요 지수</h2>
        <div class="row" id="mainIndices">
            <!-- 주요 지수 카드가 여기에 동적으로 추가됩니다 -->
            <div class="col-12 text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </div>

        <h2 class="mt-4 mb-3">항만 혼잡도</h2>
        <div class="row" id="portCongestion">
            <!-- 항만 혼잡도 카드가 여기에 동적으로 추가됩니다 -->
            <div class="col-12 text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </div>

        <h2 class="mt-4 mb-3">주요 노선별 운임</h2>
        <div class="row" id="freightRates">
            <!-- 운임 정보 카드가 여기에 동적으로 추가됩니다 -->
            <div class="col-12 text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </div>

        <h2 class="mt-4 mb-3">데이터 카테고리</h2>
        <div class="row" id="categories">
            <!-- 카테고리 카드가 여기에 동적으로 추가됩니다 -->
        </div>
    </div>

    <footer class="footer mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>해운 데이터 센터</h5>
                    <p>글로벌 해운 시장 데이터를 실시간으로 제공합니다.</p>
                </div>
                <div class="col-md-3">
                    <h5>바로가기</h5>
                    <ul class="list-unstyled">
                        <li><a href="/" class="text-white">홈</a></li>
                        <li><a href="/indices" class="text-white">해운 지수</a></li>
                        <li><a href="/ports" class="text-white">항만 혼잡도</a></li>
                        <li><a href="/freight" class="text-white">운임 정보</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h5>API</h5>
                    <ul class="list-unstyled">
                        <li><a href="/api/status" class="text-white">API 상태</a></li>
                        <li><a href="/api/indices" class="text-white">지수 데이터</a></li>
                        <li><a href="/api/ports" class="text-white">항만 데이터</a></li>
                        <li><a href="/api/freight-rates" class="text-white">운임 데이터</a></li>
                    </ul>
                </div>
            </div>
            <hr class="bg-white">
            <div class="text-center">
                <p>&copy; 2023 해운 데이터 센터. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 로딩 인디케이터
            const loading = document.getElementById('loading');
            
            // 데이터 로드 함수
            async function loadData() {
                try {
                    // 카테고리 데이터 로드
                    const categoriesResponse = await fetch('/api/categories');
                    const categoriesData = await categoriesResponse.json();
                    renderCategories(categoriesData.categories);
                    
                    // 대시보드 데이터 로드
                    const dashboardResponse = await fetch('/api/dashboard');
                    const dashboardData = await dashboardResponse.json();
                    
                    // 최종 업데이트 시간 표시
                    document.getElementById('lastUpdate').textContent = 
                        `최종 업데이트: ${new Date(dashboardData.timestamp).toLocaleString('ko-KR')}`;
                    
                    // 주요 지수 렌더링
                    renderMainIndices(dashboardData.indices);
                    
                    // 항만 혼잡도 렌더링
                    renderPortCongestion(dashboardData.ports);
                    
                    // 운임 정보 렌더링
                    renderFreightRates(dashboardData.freight);
                    
                    // 로딩 인디케이터 숨기기
                    loading.style.display = 'none';
                } catch (error) {
                    console.error('데이터 로드 중 오류 발생:', error);
                    document.getElementById('lastUpdate').textContent = 
                        '데이터 로드 중 오류가 발생했습니다.';
                    loading.style.display = 'none';
                }
            }
            
            // 카테고리 렌더링 함수
            function renderCategories(categories) {
                const categoriesContainer = document.getElementById('categories');
                categoriesContainer.innerHTML = '';
                
                categories.forEach(category => {
                    const col = document.createElement('div');
                    col.className = 'col-lg-3 col-md-4 col-sm-6 mb-4';
                    
                    col.innerHTML = `
                        <div class="card h-100 text-center">
                            <div class="card-body">
                                <div class="category-icon">
                                    <i class="bi bi-${category.icon}"></i>
                                </div>
                                <h5 class="card-title">${category.name}</h5>
                                <a href="/${category.id}" class="btn btn-sm btn-outline-primary mt-2">자세히 보기</a>
                            </div>
                        </div>
                    `;
                    
                    categoriesContainer.appendChild(col);
                });
            }
            
            // 주요 지수 렌더링 함수
            function renderMainIndices(data) {
                const indicesContainer = document.getElementById('mainIndices');
                indicesContainer.innerHTML = '';
                
                // 주요 지수만 필터링 (상위 4개)
                const topIndices = data.indices
                    .sort((a, b) => Math.abs(b.changePercent) - Math.abs(a.changePercent))
                    .slice(0, 4);
                
                topIndices.forEach(index => {
                    const col = document.createElement('div');
                    col.className = 'col-lg-3 col-md-6 col-sm-6 mb-4';
                    
                    const changeClass = index.changePercent >= 0 ? 'positive' : 'negative';
                    const changeIcon = index.changePercent >= 0 ? 'bi-arrow-up' : 'bi-arrow-down';
                    const changeSign = index.changePercent >= 0 ? '+' : '';
                    
                    col.innerHTML = `
                        <div class="card h-100">
                            <div class="card-header bg-dark text-white">
                                ${index.name}
                            </div>
                            <div class="card-body stats-card">
                                <div class="stat-value">${index.value.toLocaleString()}</div>
                                <div class="stat-change ${changeClass}">
                                    <i class="bi ${changeIcon}"></i> 
                                    ${changeSign}${index.changePercent.toFixed(2)}%
                                </div>
                                <div class="stat-label mt-2">
                                    출처: ${index.source} | ${data.date}
                                </div>
                            </div>
                        </div>
                    `;
                    
                    indicesContainer.appendChild(col);
                });
            }
            
            // 항만 혼잡도 렌더링 함수
            function renderPortCongestion(data) {
                const portContainer = document.getElementById('portCongestion');
                portContainer.innerHTML = '';
                
                // 항만 혼잡도 상위 4개
                const topPorts = data.ports
                    .sort((a, b) => b.congestionLevel - a.congestionLevel)
                    .slice(0, 4);
                
                topPorts.forEach(port => {
                    const col = document.createElement('div');
                    col.className = 'col-lg-3 col-md-6 col-sm-6 mb-4';
                    
                    let levelClass = '';
                    if (port.congestionLevel >= 7) {
                        levelClass = 'bg-danger text-white';
                    } else if (port.congestionLevel >= 4) {
                        levelClass = 'bg-warning';
                    } else {
                        levelClass = 'bg-success text-white';
                    }
                    
                    col.innerHTML = `
                        <div class="card h-100">
                            <div class="card-header ${levelClass}">
                                ${port.name} (${port.country})
                            </div>
                            <div class="card-body stats-card">
                                <div class="stat-value">${port.congestionLevel}/10</div>
                                <div class="stat-label">혼잡도 레벨</div>
                                <div class="mt-2">
                                    <small>대기 선박: ${port.waitingVessels}척</small><br>
                                    <small>평균 대기시간: ${port.avgWaitTime}시간</small>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    portContainer.appendChild(col);
                });
            }
            
            // 운임 정보 렌더링 함수
            function renderFreightRates(data) {
                const ratesContainer = document.getElementById('freightRates');
                ratesContainer.innerHTML = '';
                
                // 주요 운임 정보 상위 4개
                const topRoutes = data.routes
                    .sort((a, b) => Math.abs(b.changePercent) - Math.abs(a.changePercent))
                    .slice(0, 4);
                
                topRoutes.forEach(route => {
                    const col = document.createElement('div');
                    col.className = 'col-lg-3 col-md-6 col-sm-6 mb-4';
                    
                    const changeClass = route.changePercent >= 0 ? 'positive' : 'negative';
                    const changeIcon = route.changePercent >= 0 ? 'bi-arrow-up' : 'bi-arrow-down';
                    const changeSign = route.changePercent >= 0 ? '+' : '';
                    
                    col.innerHTML = `
                        <div class="card h-100">
                            <div class="card-header bg-dark text-white">
                                ${route.origin} → ${route.destination}
                            </div>
                            <div class="card-body stats-card">
                                <div class="stat-value">$${route.rate.toLocaleString()}</div>
                                <div class="stat-change ${changeClass}">
                                    <i class="bi ${changeIcon}"></i> 
                                    ${changeSign}${route.changePercent.toFixed(2)}%
                                </div>
                                <div class="stat-label mt-2">
                                    ${route.vesselType} | ${route.unit}
                                </div>
                            </div>
                        </div>
                    `;
                    
                    ratesContainer.appendChild(col);
                });
            }
            
            // 데이터 로드 시작
            loadData();
        });
    </script>
</body>
</html> 